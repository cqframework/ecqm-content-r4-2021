{
  "resourceType": "Library",
  "id": "CumulativeMedicationDurationFHIR4",
  "meta": {
    "versionId": "1",
    "lastUpdated": "2021-06-25T16:28:27.000-04:00",
    "source": "#WvkAD2m8mJWhJlcs",
    "profile": [ "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/computable-library-cqfm" ]
  },
  "language": "en",
  "extension": [ {
    "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem",
    "valueReference": {
      "reference": "Device/cqf-tooling"
    }
  } ],
  "url": "http://ecqi.healthit.gov/ecqms/Library/CumulativeMedicationDurationFHIR4",
  "version": "1.0.000",
  "name": "CumulativeMedicationDurationFHIR4",
  "status": "active",
  "experimental": false,
  "type": {
    "coding": [ {
      "system": "http://terminology.hl7.org/CodeSystem/library-type",
      "code": "logic-library"
    } ]
  },
  "date": "2021-06-25T20:28:26+00:00",
  "publisher": "ESAC, Inc.",
  "description": "This library provides guidance for calculating Cumulative Medication Duration\nusing FHIR R4.",
  "content": [ {
    "contentType": "text/cql",
    "data": "bGlicmFyeSBDdW11bGF0aXZlTWVkaWNhdGlvbkR1cmF0aW9uRkhJUjQgdmVyc2lvbiAnMS4wLjAwMCcKCnVzaW5nIEZISVIgdmVyc2lvbiAnNC4wLjEnCgppbmNsdWRlIEZISVJIZWxwZXJzIHZlcnNpb24gJzQuMC4wMDEnIGNhbGxlZCBGSElSSGVscGVycwoKY29kZXN5c3RlbSAiVjNUaW1pbmdFdmVudCI6ICdodHRwOi8vdGVybWlub2xvZ3kuaGw3Lm9yZy9Db2RlU3lzdGVtL3YzLVRpbWluZ0V2ZW50JyAKY29kZXN5c3RlbSAiRXZlbnRUaW1pbmciOiAnaHR0cDovL2hsNy5vcmcvZmhpci9ldmVudC10aW1pbmcnIAoKY29kZSAiQUMiOiAnQUMnIGZyb20gIlYzVGltaW5nRXZlbnQiIGRpc3BsYXkgJ0FDJwpjb2RlICJBQ0QiOiAnQUNEJyBmcm9tICJWM1RpbWluZ0V2ZW50IiBkaXNwbGF5ICdBQ0QnCmNvZGUgIkFDTSI6ICdBQ00nIGZyb20gIlYzVGltaW5nRXZlbnQiIGRpc3BsYXkgJ0FDTScKY29kZSAiQUNWIjogJ0FDVicgZnJvbSAiVjNUaW1pbmdFdmVudCIgZGlzcGxheSAnQUNWJwpjb2RlICJBRlQiOiAnQUZUJyBmcm9tICJFdmVudFRpbWluZyIgZGlzcGxheSAnQUZUJwpjb2RlICJBRlQuZWFybHkiOiAnQUZULmVhcmx5JyBmcm9tICJFdmVudFRpbWluZyIgZGlzcGxheSAnQUZULmVhcmx5Jwpjb2RlICJBRlQubGF0ZSI6ICdBRlQubGF0ZScgZnJvbSAiRXZlbnRUaW1pbmciIGRpc3BsYXkgJ0FGVC5sYXRlJwpjb2RlICJDIjogJ0MnIGZyb20gIlYzVGltaW5nRXZlbnQiIGRpc3BsYXkgJ0MnCmNvZGUgIkNEIjogJ0NEJyBmcm9tICJWM1RpbWluZ0V2ZW50IiBkaXNwbGF5ICdDRCcKY29kZSAiQ00iOiAnQ00nIGZyb20gIlYzVGltaW5nRXZlbnQiIGRpc3BsYXkgJ0NNJwpjb2RlICJDViI6ICdDVicgZnJvbSAiVjNUaW1pbmdFdmVudCIgZGlzcGxheSAnQ1YnCmNvZGUgIkVWRSI6ICdFVkUnIGZyb20gIkV2ZW50VGltaW5nIiBkaXNwbGF5ICdFVkUnCmNvZGUgIkVWRS5lYXJseSI6ICdFVkUuZWFybHknIGZyb20gIkV2ZW50VGltaW5nIiBkaXNwbGF5ICdFVkUuZWFybHknCmNvZGUgIkVWRS5sYXRlIjogJ0VWRS5sYXRlJyBmcm9tICJFdmVudFRpbWluZyIgZGlzcGxheSAnRVZFLmxhdGUnCmNvZGUgIkhTIjogJ0hTJyBmcm9tICJWM1RpbWluZ0V2ZW50IiBkaXNwbGF5ICdIUycKY29kZSAiTU9STiI6ICdNT1JOJyBmcm9tICJFdmVudFRpbWluZyIgZGlzcGxheSAnTU9STicKY29kZSAiTU9STi5lYXJseSI6ICdNT1JOLmVhcmx5JyBmcm9tICJFdmVudFRpbWluZyIgZGlzcGxheSAnTU9STi5lYXJseScKY29kZSAiTU9STi5sYXRlIjogJ01PUk4ubGF0ZScgZnJvbSAiRXZlbnRUaW1pbmciIGRpc3BsYXkgJ01PUk4ubGF0ZScKY29kZSAiTklHSFQiOiAnTklHSFQnIGZyb20gIkV2ZW50VGltaW5nIiBkaXNwbGF5ICdOSUdIVCcKY29kZSAiTk9PTiI6ICdOT09OJyBmcm9tICJFdmVudFRpbWluZyIgZGlzcGxheSAnTk9PTicKY29kZSAiUEMiOiAnUEMnIGZyb20gIlYzVGltaW5nRXZlbnQiIGRpc3BsYXkgJ1BDJwpjb2RlICJQQ0QiOiAnUENEJyBmcm9tICJWM1RpbWluZ0V2ZW50IiBkaXNwbGF5ICdQQ0QnCmNvZGUgIlBDTSI6ICdQQ00nIGZyb20gIlYzVGltaW5nRXZlbnQiIGRpc3BsYXkgJ1BDTScKY29kZSAiUENWIjogJ1BDVicgZnJvbSAiVjNUaW1pbmdFdmVudCIgZGlzcGxheSAnUENWJwpjb2RlICJQSFMiOiAnUEhTJyBmcm9tICJFdmVudFRpbWluZyIgZGlzcGxheSAnUEhTJwpjb2RlICJXQUtFIjogJ1dBS0UnIGZyb20gIlYzVGltaW5nRXZlbnQiIGRpc3BsYXkgJ1dBS0UnCgpwYXJhbWV0ZXIgIkVycm9yTGV2ZWwiIFN0cmluZyBkZWZhdWx0ICdXYXJuaW5nJwoKY29udGV4dCBQYXRpZW50CgovKkNhbGN1bGF0ZXMgZGFpbHkgZnJlcXVlbmN5IGdpdmVuIGZyZXF1ZW5jeSB3aXRoaW4gYSBwZXJpb2QqLwpkZWZpbmUgZnVuY3Rpb24gIlRvRGFpbHkiKGZyZXF1ZW5jeSBTeXN0ZW0uSW50ZWdlciwgcGVyaW9kIFN5c3RlbS5RdWFudGl0eSApOgogIGNhc2UgcGVyaW9kLnVuaXQKICAgIHdoZW4gJ2gnIHRoZW4gZnJlcXVlbmN5ICogKDI0LjAgLyBwZXJpb2QudmFsdWUpCiAgICB3aGVuICdtaW4nIHRoZW4gZnJlcXVlbmN5ICogKDI0LjAgLyBwZXJpb2QudmFsdWUpICogNjAKICAgIHdoZW4gJ3MnIHRoZW4gZnJlcXVlbmN5ICogKDI0LjAgLyBwZXJpb2QudmFsdWUpICogNjAgKiA2MAogICAgd2hlbiAnZCcgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgLyAyNAogICAgd2hlbiAnd2snIHRoZW4gZnJlcXVlbmN5ICogKDI0LjAgLyBwZXJpb2QudmFsdWUpIC8gKDI0ICogNykKICAgIHdoZW4gJ21vJyB0aGVuIGZyZXF1ZW5jeSAqICgyNC4wIC8gcGVyaW9kLnZhbHVlKSAvICgyNCAqIDMwKSAvKiBhc3N1bWluZyAzMCBkYXlzIGluIG1vbnRoICovCiAgICB3aGVuICdhJyB0aGVuIGZyZXF1ZW5jeSAqICgyNC4wIC8gcGVyaW9kLnZhbHVlKSAvICgyNCAqIDM2NSkgLyogYXNzdW1pbmcgMzY1IGRheXMgaW4geWVhciAqLwogICAgd2hlbiAnaG91cicgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkKICAgIHdoZW4gJ21pbnV0ZScgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgKiA2MAogICAgd2hlbiAnc2Vjb25kJyB0aGVuIGZyZXF1ZW5jeSAqICgyNC4wIC8gcGVyaW9kLnZhbHVlKSAqIDYwICogNjAKICAgIHdoZW4gJ2RheScgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgLyAyNAogICAgd2hlbiAnd2VlaycgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgLyAoMjQgKiA3KQogICAgd2hlbiAnbW9udGgnIHRoZW4gZnJlcXVlbmN5ICogKDI0LjAgLyBwZXJpb2QudmFsdWUpIC8gKDI0ICogMzApIC8qIGFzc3VtaW5nIDMwIGRheXMgaW4gbW9udGggKi8KICAgIHdoZW4gJ3llYXInIHRoZW4gZnJlcXVlbmN5ICogKDI0LjAgLyBwZXJpb2QudmFsdWUpIC8gKDI0ICogMzY1KSAvKiBhc3N1bWluZyAzNjUgZGF5cyBpbiB5ZWFyICovCiAgICB3aGVuICdob3VycycgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkKICAgIHdoZW4gJ21pbnV0ZXMnIHRoZW4gZnJlcXVlbmN5ICogKDI0LjAgLyBwZXJpb2QudmFsdWUpICogNjAKICAgIHdoZW4gJ3NlY29uZHMnIHRoZW4gZnJlcXVlbmN5ICogKDI0LjAgLyBwZXJpb2QudmFsdWUpICogNjAgKiA2MAogICAgd2hlbiAnZGF5cycgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgLyAyNAogICAgd2hlbiAnd2Vla3MnIHRoZW4gZnJlcXVlbmN5ICogKDI0LjAgLyBwZXJpb2QudmFsdWUpIC8gKDI0ICogNykKICAgIHdoZW4gJ21vbnRocycgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgLyAoMjQgKiAzMCkgLyogYXNzdW1pbmcgMzAgZGF5cyBpbiBtb250aCAqLwogICAgd2hlbiAneWVhcnMnIHRoZW4gZnJlcXVlbmN5ICogKDI0LjAgLyBwZXJpb2QudmFsdWUpIC8gKDI0ICogMzY1KSAvKiBhc3N1bWluZyAzNjUgZGF5cyBpbiB5ZWFyICovCiAgICBlbHNlIE1lc3NhZ2UobnVsbCwgdHJ1ZSwgJ0NNRExvZ2ljLlRvRGFpbHkuVW5rbm93blVuaXQnLCBFcnJvckxldmVsLCAnVW5rbm93biB1bml0ICcgJiBwZXJpb2QudW5pdCkKICBlbmQKCi8qUmV0dXJucyBhIGRhaWx5IGZyZXF1ZW5jeSBmb3IgdGhlIGdpdmVuIGNvZGUgcmVwcmVzZW50YXRpb24gb2YgZnJlcXVlbmN5LgogIFRoZSBmdW5jdGlvbiBleHBlY3RzIGNvZGVzIGZyb20gdGhlIFtFdmVudFRpbWluZ10oaHR0cDovL2hsNy5vcmcvZmhpci9jb2Rlc3lzdGVtLWV2ZW50LXRpbWluZy5odG1sKSBvcgogIFtWM1RpbWluZ0V2ZW50XShodHRwOi8vaGw3Lm9yZy9maGlyL3YzL1RpbWluZ0V2ZW50L2NzLmh0bWwpIGNvZGUgc3lzdGVtcy4KICAvLyBUT0RPOiBEZXRlcm1pbmUgd2hldGhlciBvciBub3Qgd2Ugc2hvdWxkIHVzZSB0aW1pbmcuY29kZSBhdCBhbGwuLi4uKi8KZGVmaW5lIGZ1bmN0aW9uICJUb0RhaWx5IihmcmVxdWVuY3kgQ29kZSApOgogIGNhc2UgZnJlcXVlbmN5CiAgICB3aGVuICJDIiB0aGVuIDMuMAogICAgLy8gZXRjLgogICAgZWxzZSBNZXNzYWdlKG51bGwsIHRydWUsICdDTURMb2dpYy5Ub0RhaWx5LlVua25vd25GcmVxdWVuY3lDb2RlJywgRXJyb3JMZXZlbCwgJ1Vua25vd24gZnJlcXVlbmN5IGNvZGUgJyAmIGZyZXF1ZW5jeS5jb2RlKQogIGVuZAogIAogIC8qCiAgTm93IHRoYXQgd2UgaGF2ZSBhIFRvRGFpbHkgZnVuY3Rpb24sIHdlIGNhbiBhcHByb2FjaCBjYWxjdWxhdGlvbiBvZiB0aGUKICBkdXJhdGlvbiBvZiBtZWRpY2F0aW9uIGZvciBhbiBvcmRlci4gRmlyc3QsIGNvbnNpZGVyIHRoZSBkZWZpbml0aW9ucwogIGZvciBlYWNoIGVsZW1lbnQ6CiAgCiAgKiAxIGFuZCBvbmx5IDEgZG9zYWdlSW5zdHJ1Y3Rpb24KICAqIDEgYW5kIG9ubHkgMSBkb3NlQW5kUmF0ZQogICogMSB0aW1pbmcgd2l0aCAxIHJlcGVhdAogICogZnJlcXVlbmN5LCBmcmVxdWVuY3lNYXgsIGRlZmF1bHRpbmcgdG8gMQogICogcGVyaW9kLCBwZXJpb2RVbml0LCBkZWZhdWx0aW5nIHRvIDEgJ2QnCiAgKiBkb3NlUXVhbnRpdHkgb3IgZG9zZVJhbmdlCiAgKiB0aW1lT2ZEYXkKICAKICAqIGF1dGhvcmVkT246IFRoZSBkYXRlIHRoZSBwcmVzY3JpcHRpb24gd2FzIHdyaXR0ZW4KICAqIGRpc3BlbnNlUmVxdWVzdC52YWxpZGl0eVBlcmlvZDogVGltZSBwZXJpb2Qgc3VwcGx5IGlzIGF1dGhvcml6ZWQgZm9yCiAgKiBkaXNwZW5zZVJlcXVlc3QucXVhbnRpdHk6IGFtb3VudCBvZiBtZWRpY2F0aW9uIHN1cHBsaWVkIHBlciBkaXNwZW5zZQogICogZGlzcGVuc2VSZXF1ZXN0Lm51bWJlck9mUmVwZWF0c0FsbG93ZWQ6IG51bWJlciBvZiByZWZpbGxzIGF1dGhvcml6ZWQKICAqIGRpc3BlbnNlUmVxdWVzdC5leHBlY3RlZFN1cHBseUR1cmF0aW9uOiBudW1iZXIgb2YgZGF5cyBzdXBwbHkgcGVyIGRpc3BlbnNlCiAgKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LmJvdW5kc0R1cmF0aW9uOiB0b3RhbCBkdXJhdGlvbiBvZiB0aGUgcmVwZWF0CiAgKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LmJvdW5kc1JhbmdlOiByYW5nZSBvZiBkdXJhdGlvbnMgb2YgdGhlIHJlcGVhdAogICogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5ib3VuZHNQZXJpb2Q6IHBlcmlvZCBib3VuZHMgb2YgdGhlIHJlcGVhdAogICogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5jb3VudDogbnVtYmVyIG9mIHRpbWVzIHRvIHJlcGVhdAogICogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5jb3VudE1heDogbWF4aW11bSBudW1iZXIgb2YgdGltZXMgdG8gcmVwZWF0CiAgKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LmZyZXF1ZW5jeTogZXZlbnQgb2NjdXJzIGZyZXF1ZW5jeSB0aW1lcyBwZXIgcGVyaW9kCiAgKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LmZyZXF1ZW5jeU1heDogZXZlbnQgb2NjdXJzIHVwIHRvIGZyZXF1ZW5jeU1heCB0aW1lcyBwZXIgcGVyaW9kCiAgKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LnBlcmlvZDogZXZlbnQgb2NjdXJzIGZyZXF1ZW5jeSB0aW1lcyBwZXIgcGVyaW9kCiAgKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LnBlcmlvZE1heDogdXBwZXIgbGltaXQgb2YgcGVyaW9kCiAgKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LnBlcmlvZFVuaXQ6IHBlcmlvZCBkdXJhdGlvbiAocyB8IG1pbiB8IGggfCBkIHwgd2sgfCBtbyB8IGEpCiAgKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LnRpbWVPZkRheTogdGltZSBvZiBkYXkgZm9yIHRoZSBldmVudCAoMC4uKikKICAqIGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQud2hlbjogZXZlbnQgdGltaW5nIChIUyB8IFdBS0UgfCBDIHwgQ00gfCBDRCB8IENWIHwgQUMgfCBBQ00uLi4pCiAgKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcuY29kZTogQklEIHwgVElEIHwgUUlEIHwgQU0gfCBQTSB8IFFEIHwgUU9ELi4uCiAgKiBkb3NhZ2VJbnN0cnVjdGlvbi5hc05lZWRlZAogICogZG9zYWdlSW5zdHJ1Y3Rpb24uZG9zZUFuZFJhdGUuZG9zZVF1YW50aXR5CiAgKiBkb3NhZ2VJbnN0cnVjdGlvbi5kb3NlQW5kUmF0ZS5kb3NlUmFuZ2UKICAKICBJZiB0aGUgYm91bmRzUGVyaW9kIGlzIHByZXNlbnQgKGFuZCBjb21wbGV0ZWx5IHNwZWNpZmllZCksIHdlIGNhbiB1c2UgdGhhdCBkaXJlY3RseQogIAogICAgZG9zYWdlLnRpbWluZy5yZXBlYXQuYm91bmRzUGVyaW9kCiAgCiAgSWYgZXhwZWN0ZWRTdXBwbHlEdXJhdGlvbiBpcyBwcmVzZW50LCB0aGVuIHRoZSBkdXJhdGlvbiBpcwogIAogICAgZXhwZWN0ZWRTdXBwbHlEdXJhdGlvbiAqICgxICsgbnVtYmVyT2ZSZXBlYXRzQWxsb3dlZCkKICAKICBJZiBleHBlY3RlZFN1cHBseUR1cmF0aW9uIGlzIG5vdCBwcmVzZW50LCB0aGVuIGl0IG11c3QgYmUgY2FsY3VsYXRlZCBiYXNlZCBvbiB0aGUgcXVhbnRpdHksIGRvc2FnZSwgYW5kIGZyZXF1ZW5jeToKICAKICAgIChxdWFudGl0eSAvIChkb3NhZ2UgKiBmcmVxdWVuY3kpKSAqICgxICsgbnVtYmVyT2ZSZXBlYXRzQWxsb3dlZCkKICAKICAgIGRvc2FnZTogQ29hbGVzY2UoZW5kIG9mIGRvc2VBbmRSYXRlLmRvc2VSYW5nZSwgZG9zZUFuZFJhdGUuZG9zZVF1YW50aXR5KQogICAgZnJlcXVlbmN5OiBDb2FsZXNjZShmcmVxdWVuY3lNYXgsIGZyZXF1ZW5jeSkKICAgIHBlcmlvZDogUXVhbnRpdHkocGVyaW9kLCBwZXJpb2RVbml0KQogIAogIFRoaXMgY2FsY3VsYXRpb24gcmVzdWx0cyBpbiBhIG51bWJlciBvZiBkYXlzLCB3aGljaCBjYW4gdGhlbiBiZSB0dXJuZWQgaW50byBhIHBlcmlvZCBieSBhbmNob3JpbmcgdGhhdCB0byB0aGUKICBzdGFydCBvZiB0aGUgdmFsaWRpdHlQZXJpb2Qgb3IgdGhlIGF1dGhvcmVkT246CiAgCiAgICBJbnRlcnZhbFtlYXJsaWVzdERpc3BlbnNhYmxlLCBlYXJsaWVzdERpc3BlbnNhYmxlICsgZXhwZWN0ZWRTdXBwbHlEdXJhdGlvbl0KICAKICAgIGVhcmxpZXN0RGlzcGVuc2FibGU6IENvYWxlc2NlKHN0YXJ0IG9mIHZhbGlkaXR5UGVyaW9kLCBhdXRob3JlZE9uKQogIAogIFRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaWxsdXN0cmF0ZXMgdGhpcyBjb21wbGV0ZWx5OgogICovCgovKkNhbGN1bGF0ZXMgdGhlIE1lZGljYXRpb24gUGVyaW9kIGZvciBhIHNpbmdsZSBNZWRpY2F0aW9uUmVxdWVzdC4KTWVkaWNhdGlvblJlcXVlc3QgaW5zdGFuY2VzIHByb3ZpZGVkIHRvIHRoaXMgZnVuY3Rpb24gYXJlIGV4cGVjdGVkCnRvIGNvbmZvcm0gdG8gdGhlIFtNTUVNZWRpY2F0aW9uUmVxdWVzdF0oaHR0cDovL2J1aWxkLmZoaXIub3JnL2lnL2NxZnJhbWV3b3JrL29waW9pZC1tbWUtcjQvU3RydWN0dXJlRGVmaW5pdGlvbi1tbWVtZWRpY2F0aW9ucmVxdWVzdC5odG1sKQpwcm9maWxlLCB3aGljaCBleHBlY3RzOgoqIDEgYW5kIG9ubHkgMSBkb3NhZ2VJbnN0cnVjdGlvbiwgbXVsdGlwbGUgZG9zYWdlSW5zdHJ1Y3Rpb24gZWxlbWVudHMgd2lsbCByZXN1bHQgaW4gYW4gZXJyb3IKKiAxIGFuZCBvbmx5IDEgZG9zZUFuZFJhdGUsIG11bHRpcGxlIGRvc2VBbmRSYXRlIGVsZW1lbnRzIHdpbGwgcmVzdWx0IGluIGFuIGVycm9yCiogMSB0aW1pbmcgd2l0aCAxIHJlcGVhdCwgbWlzc2luZyB0aW1pbmcgb3IgcmVwZWF0IGVsZW1lbnRzIHdpbGwgcmVzdWx0IGluIGEgbnVsbAoqIGZyZXF1ZW5jeSwgZnJlcXVlbmN5TWF4LCBkZWZhdWx0aW5nIHRvIDEKKiBwZXJpb2QsIHBlcmlvZFVuaXQsIGRlZmF1bHRpbmcgdG8gMSAnZCcKKiB0aW1lT2ZEYXkKKiBkb3NlUXVhbnRpdHkgb3IgZG9zZVJhbmdlLCBtaXNzaW5nIGRvc2VRdWFudGl0eSBhbmQgZG9zZVJhbmdlIHdpbGwgcmVzdWx0IGluIGEgbnVsbApOb3RlIHRoYXQgTWVkaWNhdGlvblJlcXVlc3Qgc3RhdHVzIGlzIG5vdCBjb25zaWRlcmVkIGJ5IHRoaXMgY2FsY3VsYXRpb24sIGFzIHRoZQpsaXN0IG9mIE1lZGljYXRpb25SZXF1ZXN0IGluc3RhbmNlcyBwcm92aWRlZCB0byB0aGlzIGZ1bmN0aW9uIHNob3VsZCBhbHJlYWR5IGhhdmUKY29uc2lkZXJlZCBhcHByb3ByaWF0ZSBzdGF0dXNlcywgZGVwZW5kaW5nIG9uIHRoZSB1c2UgY2FzZSwgdHlwaWNhbGx5IGBjb21wbGV0ZWRgLiovCmRlZmluZSBmdW5jdGlvbiAiTWVkaWNhdGlvblJlcXVlc3RQZXJpb2QiKFJlcXVlc3QgIk1lZGljYXRpb25SZXF1ZXN0IiApOgogIFJlcXVlc3QgUgogICAgbGV0CiAgICAgIGRvc2FnZTogc2luZ2xldG9uIGZyb20gUi5kb3NhZ2VJbnN0cnVjdGlvbiwKICAgICAgZG9zZUFuZFJhdGU6IHNpbmdsZXRvbiBmcm9tIGRvc2FnZS5kb3NlQW5kUmF0ZSwKICAgICAgZG9zZVJhbmdlOiBkb3NlQW5kUmF0ZS5kb3NlIGFzIFJhbmdlLAogICAgICBkb3NlUXVhbnRpdHk6IGRvc2VBbmRSYXRlLmRvc2UgYXMgU2ltcGxlUXVhbnRpdHksCiAgICAgIGRvc2U6IENvYWxlc2NlKGVuZCBvZiBkb3NlUmFuZ2UsIGRvc2VRdWFudGl0eSksCiAgICAgIHRpbWluZzogZG9zYWdlLnRpbWluZywKICAgICAgZnJlcXVlbmN5OiBDb2FsZXNjZSh0aW1pbmcucmVwZWF0LmZyZXF1ZW5jeU1heCwgdGltaW5nLnJlcGVhdC5mcmVxdWVuY3kpLAogICAgICBwZXJpb2Q6IFN5c3RlbS5RdWFudGl0eSB7IHZhbHVlOiB0aW1pbmcucmVwZWF0LnBlcmlvZCwgdW5pdDogdGltaW5nLnJlcGVhdC5wZXJpb2RVbml0LnZhbHVlIH0sCiAgICAgIGRvc2VzUGVyRGF5OiBDb2FsZXNjZShUb0RhaWx5KGZyZXF1ZW5jeSwgcGVyaW9kKSwgQ291bnQodGltaW5nLnJlcGVhdC50aW1lT2ZEYXkpLCAxLjApLAogICAgICBib3VuZHNQZXJpb2Q6IHRpbWluZy5yZXBlYXQuYm91bmRzIGFzIFBlcmlvZCwKICAgICAgZGF5c1N1cHBseTogUi5kaXNwZW5zZVJlcXVlc3QuZXhwZWN0ZWRTdXBwbHlEdXJhdGlvbiwKICAgICAgcXVhbnRpdHk6IFIuZGlzcGVuc2VSZXF1ZXN0LnF1YW50aXR5LAogICAgICByZWZpbGxzOiBDb2FsZXNjZShSLmRpc3BlbnNlUmVxdWVzdC5udW1iZXJPZlJlcGVhdHNBbGxvd2VkLCAwKSwKICAgICAgc3RhcnREYXRlOgogICAgICAgIENvYWxlc2NlKAogICAgICAgICAgc3RhcnQgb2YgYm91bmRzUGVyaW9kLAogICAgICAgICAgc3RhcnQgb2YgUi5kaXNwZW5zZVJlcXVlc3QudmFsaWRpdHlQZXJpb2QsCiAgICAgICAgICBSLmF1dGhvcmVkT24KICAgICAgICApCiAgICByZXR1cm4KICAgICAgaWYgbm90IChlbmQgb2YgYm91bmRzUGVyaW9kIGlzIG51bGwgb3IgZW5kIG9mIGJvdW5kc1BlcmlvZCA9IG1heGltdW0gRGF0ZVRpbWUpIHRoZW4KICAgICAgICBJbnRlcnZhbFtzdGFydERhdGUsIGVuZCBvZiBib3VuZHNQZXJpb2RdCiAgICAgIGVsc2UKICAgICAgICBJbnRlcnZhbFtzdGFydERhdGUsIHN0YXJ0RGF0ZSArIENvYWxlc2NlKGRheXNTdXBwbHksIHF1YW50aXR5IC8gKGRvc2UgKiBkb3Nlc1BlckRheSkpICogKDEgKyByZWZpbGxzKV0KICAKICAvKgogIE5leHQsIGNvbnNpZGVyIHRoZSBNZWRpY2F0aW9uRGlzcGVuc2UgY2FzZToKICAKICAqIHdoZW5QcmVwYXJlZDogV2hlbiBwcm9kdWN0IHdhcyBwcmVwYXJlZAogICogd2hlbkhhbmRlZE92ZXI6IFdoZW4gcHJvZHVjdCB3YXMgZ2l2ZW4gb3V0CiAgKiBxdWFudGl0eTogQW1vdW50IGRpc3BlbnNlZAogICogZGF5c1N1cHBseTogQW1vdW50IG9mIG1lZGljYXRpb24gZXhwcmVzc2VkIGFzIGEgdGltaW5nIGFtb3VudAogICogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5ib3VuZHNEdXJhdGlvbjogdG90YWwgZHVyYXRpb24gb2YgdGhlIHJlcGVhdAogICogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5ib3VuZHNSYW5nZTogcmFuZ2Ugb2YgZHVyYXRpb25zIG9mIHRoZSByZXBlYXQKICAqIGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQuYm91bmRzUGVyaW9kOiBwZXJpb2QgYm91bmRzIG9mIHRoZSByZXBlYXQKICAqIGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQuY291bnQ6IG51bWJlciBvZiB0aW1lcyB0byByZXBlYXQKICAqIGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQuY291bnRNYXg6IG1heGltdW0gbnVtYmVyIG9mIHRpbWVzIHRvIHJlcGVhdAogICogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5mcmVxdWVuY3k6IGV2ZW50IG9jY3VycyBmcmVxdWVuY3kgdGltZXMgcGVyIHBlcmlvZAogICogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5mcmVxdWVuY3lNYXg6IGV2ZW50IG9jY3VycyB1cCB0byBmcmVxdWVuY3lNYXggdGltZXMgcGVyIHBlcmlvZAogICogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5wZXJpb2Q6IGV2ZW50IG9jY3VycyBmcmVxdWVuY3kgdGltZXMgcGVyIHBlcmlvZAogICogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5wZXJpb2RNYXg6IHVwcGVyIGxpbWl0IG9mIHBlcmlvZAogICogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5wZXJpb2RVbml0OiBwZXJpb2QgZHVyYXRpb24gKHMgfCBtaW4gfCBoIHwgZCB8IHdrIHwgbW8gfCBhKQogICogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC50aW1lT2ZEYXk6IHRpbWUgb2YgZGF5IGZvciB0aGUgZXZlbnQgKDAuLiopCiAgKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LndoZW46IGV2ZW50IHRpbWluZyAoSFMgfCBXQUtFIHwgQyB8IENNIHwgQ0QgfCBDViB8IEFDIHwgQUNNLi4uKQogICogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLmNvZGU6IEJJRCB8IFRJRCB8IFFJRCB8IEFNIHwgUE0gfCBRRCB8IFFPRC4uLgogICogZG9zYWdlSW5zdHJ1Y3Rpb24uYXNOZWVkZWQKICAqIGRvc2FnZUluc3RydWN0aW9uLmRvc2VBbmRSYXRlLmRvc2VRdWFudGl0eQogICogZG9zYWdlSW5zdHJ1Y3Rpb24uZG9zZUFuZFJhdGUuZG9zZVJhbmdlCiAgCiAgV2UgaGF2ZSBlZmZlY3RpdmVseSB0aGUgc2FtZSBlbGVtZW50cywgd2l0aCB0aGUgc2FtZSBtZWFuaW5ncywgd2l0aCB0aGUgZXhjZXB0aW9uIHRoYXQgdGhlCiAgZXZlbnQgaXMgZG9jdW1lbnRpbmcgYSBzaW5nbGUgZGlzcGVuc2UsIGFuZCBkb2VzIG5vdCBjb250YWluIHJlZmlsbCBpbmZvcm1hdGlvbi4gSW4gYWRkaXRpb24sCiAgbXVsdGlwbGUgZGlzcGVuc2UgZXZlbnRzIHdvdWxkIHR5cGljYWxseSBiZSBwcmVzZW50LCBhbmQgdGhvc2Ugd291bGQgYWxsIGhhdmUgdG8gYmUgY29uc2lkZXJlZAogIGFzIHBhcnQgb2YgYW4gb3ZlcmFsbCBjYWxjdWxhdGlvbi4gVGhhdCB3aWxsIGJlIGNvbnNpZGVyZWQgd2hlbiB3ZSBjb21iaW5lIHJlc3VsdHMsIGJ1dCBmb3IKICB0aGlzIGZ1bmN0aW9uLCB3ZSdsbCBmb2N1cyBvbiBjYWxjdWxhdGluZyB0aGUgZHVyYXRpb24gb2YgYSBzaW5nbGUgZGlzcGVuc2UuCiAgCiAgV2l0aCBhIE1lZGljYXRpb25EaXNwZW5zZSwgZG9zYWdlIGluZm9ybWF0aW9uIGlzIGV4cGVjdGVkIHRvIGJlIHRoZSBzYW1lIGFzIHRoZSByZWxhdGVkCiAgTWVkaWNhdGlvblJlcXVlc3QsIHNvIGJvdW5kc1BlcmlvZCB3b3VsZCBzdGlsbCBjb3ZlciB0aGUgZW50aXJlIHByZXNjcmlwdGlvbiAoaW5jbHVkaW5nIHJlZmlsbHMpCiAgYW5kIHNvIGNhbm5vdCBiZSB1c2VkIHRvIGNhbGN1bGF0ZSB0aGUgaW50ZXJ2YWwgY292ZXJlZCBieSB0aGUgZGlzcGVuc2UuCiAgCiAgSWYgdGhlIGRheXNTdXBwbHkgZWxlbWVudCBpcyBwcmVzZW50LCB0aGVuIHRoZSBkdXJhdGlvbiBpbiBkYXlzIGlzIHNpbXBseQogIAogICAgZGF5c1N1cHBseQogIAogIE5vdGUgc3BlY2lmaWNhbGx5IHRoYXQgd2UgYXJlIG5vdCBjb25zaWRlcmluZyByZWZpbGxzLCBhcyB0aG9zZSB3b3VsZCBiZSBjb3ZlcmVkCiAgYnkgc3Vic2VxdWVudCBkaXNwZW5zZSByZWNvcmRzLgogIAogIElmIGRheXNTdXBwbGllZCBpcyBub3QgcHJlc2VudCwgdGhlbiBkYXlzU3VwcGxpZWQgbXVzdCBiZSBjYWxjdWxhdGVkIGJhc2VkIG9uCiAgdGhlIHF1YW50aXR5LCBkb3NhZ2UsIGFuZCBmcmVxdWVuY3k6CiAgCiAgICAocXVhbnRpdHkgLyAoZG9zYWdlICogZnJlcXVlbmN5KSkKICAKICBUaGlzIGNhbGN1bGF0aW9uIHJlc3VsdHMgaW4gYSBudW1iZXIgb2YgZGF5cywgd2hpY2ggY2FuIHRoZW4gYmUgdHVybmVkIGludG8gYQogIHBlcmlvZCBieSBhbmNob3JpbmcgdGhhdCB0byB0aGUgc3RhcnREYXRlLCBhcyBkZXRlcm1pbmVkIGJ5IHRoZSBmaXJzdCBhdmFpbGFibGUKICB2YWx1ZSBvZiB0aGUgc3RhcnQgb2YgdGhlIGJvdW5kc1BlcmlvZCwgd2hlbkhhbmRlZE92ZXIsIGFuZCB3aGVuUHJlcGFyZWQuCiAgCiAgIEludGVydmFsW3N0YXJ0RGF0ZSwgc3RhcnREYXRlICsgZHVyYXRpb25JbkRheXNdCiAgKi8KCi8qQ2FsY3VsYXRlcyBNZWRpY2F0aW9uIFBlcmlvZCBmb3IgYSBnaXZlbiBNZWRpY2F0aW9uRGlzcGVuc2UKTWVkaWNhdGlvbkRpc3BlbnNlIGluc3RhbmNlcyBwcm92aWRlZCB0byB0aGlzIGZ1bmN0aW9uIGFyZSBleHBlY3RlZAp0byBjb25mb3JtIHRvIHRoZSBbVE9ETzogTU1FTWVkaWNhdGlvbkRpc3BlbnNlXShodHRwOi8vYnVpbGQuZmhpci5vcmcvaWcvY3FmcmFtZXdvcmsvb3Bpb2lkLW1tZS1yNC9TdHJ1Y3R1cmVEZWZpbml0aW9uLW1tZW1lZGljYXRpb25kaXNwZW5zZS5odG1sKQpwcm9maWxlLCB3aGljaCBleHBlY3RzOgoqIDEgYW5kIG9ubHkgMSBkb3NhZ2VJbnN0cnVjdGlvbiwgbXVsdGlwbGUgZG9zYWdlSW5zdHJ1Y3Rpb24gZWxlbWVudHMgd2lsbCByZXN1bHQgaW4gYW4gZXJyb3IKKiAxIGFuZCBvbmx5IDEgZG9zZUFuZFJhdGUsIG11bHRpcGxlIGRvc2VBbmRSYXRlIGVsZW1lbnRzIHdpbGwgcmVzdWx0IGluIGFuIGVycm9yCiogMSB0aW1pbmcgd2l0aCAxIHJlcGVhdCwgbWlzc2luZyB0aW1pbmcgb3IgcmVwZWF0IGVsZW1lbnRzIHdpbGwgcmVzdWx0IGluIGEgbnVsbAoqIGZyZXF1ZW5jeSwgZnJlcXVlbmN5TWF4LCBkZWZhdWx0aW5nIHRvIDEKKiBwZXJpb2QsIHBlcmlvZFVuaXQsIGRlZmF1bHRpbmcgdG8gMSAnZCcKKiB0aW1lT2ZEYXkKKiBkb3NlUXVhbnRpdHkgb3IgZG9zZVJhbmdlLCBtaXNzaW5nIGRvc2VRdWFudGl0eSBhbmQgZG9zZVJhbmdlIHdpbGwgcmVzdWx0IGluIGEgbnVsbAoqIHdoZW5IYW5kZWRPdmVyIG9yIHdoZW5QcmVwYXJlZCwgaWYgbWlzc2luZyBib3RoIHdoZW5IYW5kZWRPdmVyIGFuZCB3aGVuUHJlcGFyZWQgd2lsbCByZXN1bHQgaW4gYSBudWxsCgpOb3RlIHRoYXQgTWVkaWNhdGlvbkRpc3BlbnNlIHN0YXR1cyBpcyBub3QgY29uc2lkZXJlZCBieSB0aGlzIGNhbGN1bGF0aW9uLCBhcyB0aGUKbGlzdCBvZiBNZWRpY2F0aW9uRGlzcGVuc2UgaW5zdGFuY2VzIHByb3ZpZGVkIHRvIHRoaXMgZnVuY3Rpb24gc2hvdWxkIGFscmVhZHkgaGF2ZQpjb25zaWRlcmVkIGFwcHJvcHJpYXRlIHN0YXR1c2VzLCBkZXBlbmRpbmcgb24gdGhlIHVzZSBjYXNlLCB0eXBpY2FsbHkgYGNvbXBsZXRlZGAsCmVzcGVjaWFsbHkgc2luY2Ugd2hlbkhhbmRlZE92ZXIgd291bGQgYmUgZXhwZWN0ZWQgdG8gYmUgcHJlc2VudCBmb3IgYSBjb21wbGV0ZWQKTWVkaWNhdGlvbkRpc3BlbnNlLgoKTm90ZSBhbHNvIHRoYXQgdGhlIGRvc2FnZSBpbmZvcm1hdGlvbiByZWNvcmRlZCBpbiBhIGRpc3BlbnNlIGlzIGV4cGVjdGVkIHRvIGJlIGEgY29weSBvZiB0aGUKZGlzcGVuc2UgaW5mb3JtYXRpb24gZnJvbSB0aGUgcmVsYXRlZCBtZWRpY2F0aW9uIHJlcXVlc3QuIEFzIHN1Y2gsIHRoZSBib3VuZHNQZXJpb2Qgd291bGQgYmUgZXhwZWN0ZWQKdG8gY292ZXIgdGhlIGVudGlyZSByYW5nZSwgYW5kIHNob3VsZCBfbm90XyBiZSB1c2VkIGZvciB0aW1pbmcgb2YgdGhlIGV2ZW50LgoKVGhlcmUgaXMgYWxzbyBhY3RpdmUgZGlzY3Vzc2lvbiBpbiB0aGUgUGhhcm1hY3kgV0cgYWJvdXQgd2hhdCBkYXRlIHNob3VsZCBiZSB1c2VkIGlmIHdoZW5QcmVwYXJlZC93aGVuSGFuZGVkT3ZlciBpcyBub3QgcHJlc2VudC4KVGhpcyBtYXkgdGFrZSB0aGUgZm9ybSBvZiBhbiAib3JpZ2luYWwgY3JlYXRpb24gZGF0ZSIsIGJ1dCBtYXkgYWxzbyBiZSBhICJzdGF0dXMgY2hhbmdlIGRhdGUiIGZvciBkaXNwZW5zZSBldmVudHMgdGhhdCBhcmUgdXBkYXRpbmcKc3RhdHVzIG9mIGFuIGV4aXN0aW5nIGRpc3BlbnNlLiBUaGF0IGRpc2N1c3Npb24gaXMgb25nb2luZywgc28gdW50aWwgdGhhdCBpcyByZXNvbHZlZCwgdGhpcyBsb2dpYyB3aWxsIHJldHVybgpudWxsIGlmIHdoZW5QcmVwYXJlZC93aGVuSGFuZGVkT3ZlciBhcmUgbm90IGF2YWlsYWJsZS4qLwpkZWZpbmUgZnVuY3Rpb24gIk1lZGljYXRpb25EaXNwZW5zZVBlcmlvZCIoRGlzcGVuc2UgIk1lZGljYXRpb25EaXNwZW5zZSIgKToKICBEaXNwZW5zZSBECiAgICBsZXQKICAgICAgZG9zYWdlOiBzaW5nbGV0b24gZnJvbSBELmRvc2FnZUluc3RydWN0aW9uLAogICAgICBkb3NlQW5kUmF0ZTogc2luZ2xldG9uIGZyb20gZG9zYWdlLmRvc2VBbmRSYXRlLAogICAgICBkb3NlUmFuZ2U6IGRvc2VBbmRSYXRlLmRvc2UgYXMgUmFuZ2UsCiAgICAgIGRvc2VRdWFudGl0eTogZG9zZUFuZFJhdGUuZG9zZSBhcyBTaW1wbGVRdWFudGl0eSwKICAgICAgZG9zZTogQ29hbGVzY2UoZW5kIG9mIGRvc2VSYW5nZSwgZG9zZVF1YW50aXR5KSwKICAgICAgdGltaW5nOiBkb3NhZ2UudGltaW5nLAogICAgICBmcmVxdWVuY3k6IENvYWxlc2NlKHRpbWluZy5yZXBlYXQuZnJlcXVlbmN5TWF4LCB0aW1pbmcucmVwZWF0LmZyZXF1ZW5jeSksCiAgICAgIHBlcmlvZDogU3lzdGVtLlF1YW50aXR5IHsgdmFsdWU6IHRpbWluZy5yZXBlYXQucGVyaW9kLCB1bml0OiB0aW1pbmcucmVwZWF0LnBlcmlvZFVuaXQudmFsdWUgfSwKICAgICAgZG9zZXNQZXJEYXk6IENvYWxlc2NlKFRvRGFpbHkoZnJlcXVlbmN5LCBwZXJpb2QpLCBDb3VudCh0aW1pbmcucmVwZWF0LnRpbWVPZkRheSksIDEuMCksCiAgICAgIHN0YXJ0RGF0ZToKICAgICAgICBDb2FsZXNjZSgKICAgICAgICAgIEQud2hlbkhhbmRlZE92ZXIsCiAgICAgICAgICBELndoZW5QcmVwYXJlZAogICAgICAgICkKICAgIHJldHVybgogICAgICAgIEludGVydmFsW3N0YXJ0RGF0ZSwgc3RhcnREYXRlICsgQ29hbGVzY2UoRC5kYXlzU3VwcGx5LCBELnF1YW50aXR5IC8gKGRvc2UgKiBkb3Nlc1BlckRheSkpXQoKLypSZXR1cm5zIHRoZSBlc3RhYmxpc2hlZCB0aGVyYXBldXRpYyBkdXJhdGlvbiBmb3IgYSBnaXZlbiBtZWRpY2F0aW9uLgpUaGlzIGlzIGxpa2VseSBtZWFzdXJlIHNwZWNpZmljLCB0aG91Z2ggY291bGQgcG90ZW50aWFsbHkgYmUgZXN0YWJsaXNoZWQgZm9yCmFueSBkcnVnIGFuZCBkaXN0cmlidXRlZCBhcyBhIENvZGVTeXN0ZW0gc3VwcGxlbWVudC4KRGVmYXVsdGluZyB0byAxNCBkYXlzIGhlcmUgZm9yIGlsbHVzdHJhdGlvbi4qLwpkZWZpbmUgZnVuY3Rpb24gIlRoZXJhcGV1dGljRHVyYXRpb24iKG1lZGljYXRpb24gQ29uY2VwdCApOgogIDE0IGRheXMKCi8qTmV4dCB3ZSBjb25zaWRlciBNZWRpY2F0aW9uQWRtaW5pc3RyYXRpb24uIFRoaXMgZGF0YSB0eXBlIGlzIHR5cGljYWxseSB1c2VkIHRvCmNhcHR1cmUgc3BlY2lmaWMgYWRtaW5pc3RyYXRpb24sIHdpdGggdGhlIHJlbGV2YW50UGVyaW9kIGNhcHR1cmluZyBzdGFydCBhbmQgc3RvcAp0aW1lIG9mIHRoZSBhZG1pbmlzdHJhdGlvbiBldmVudDoKCiogZWZmZWN0aXZlW3hdOiBTdGFydCBhbmQgZW5kIHRpbWUgb2YgYWRtaW5pc3RyYXRpb24KCkhvd2V2ZXIsIHdoZW4gY2FsY3VsYXRpbmcgY3VtdWxhdGl2ZSBtZWRpY2F0aW9uIGR1cmF0aW9uLCBpdCBpcyB0eXBpY2FsbHkgdGhlCnRoZXJhcGV1dGljIHBlcmlvZCBvZiB0aGUgbWVkaWNhdGlvbiB0aGF0IHNob3VsZCBiZSBjb25zaWRlcmVkLiBDdXJyZW50bHkgbmVpdGhlcgp0aGUgTWVkaWNhdGlvbiBub3IgTWVkaWNhdGlvbktub3dsZWRnZSByZXNvdXJjZXMgcHJvdmlkZSB0aGlzIGluZm9ybWF0aW9uLCBzbwp3ZSBtb2RlbCBpdCBoZXJlIGFzIGEgZnVuY3Rpb24gdGhhdCBjYW4gcG90ZW50aWFsbHkgYmUgaW1wbGVtZW50ZWQgaW4gYSB2YXJpZXR5Cm9mIHdheXMsIGluY2x1ZGluZyBtZWFzdXJlLXNwZWNpZmljIHZhbHVlcywgYXMgd2VsbCBhcyBkaXN0cmlidXRpb24gYXMgYW4gUnhOb3JtCmNvZGUgc3lzdGVtIHN1cHBsZW1lbnQuCgpIb3dldmVyIGl0IGlzIG9idGFpbmVkLCBpZiB0aGVyYXBldXRpYyBkdXJhdGlvbiBjYW4gYmUgb2J0YWluZWQsIGFuZCB0aGUgZWZmZWN0aXZlCnBlcmlvZCBoYXMgYSBzdGFydCwgdGhlIHJlc3VsdCB3aWxsIGJlCgogICAgSW50ZXJ2YWxbc3RhcnREYXRlLCBzdGFydERhdGUgKyB0aGVyYXBldXRpY0R1cmF0aW9uXSovCmRlZmluZSBmdW5jdGlvbiAiTWVkaWNhdGlvbkFkbWluaXN0cmF0aW9uUGVyaW9kIihBZG1pbmlzdHJhdGlvbiAiTWVkaWNhdGlvbkFkbWluaXN0cmF0aW9uIiApOgogIEFkbWluaXN0cmF0aW9uIE0KICAgIGxldAogICAgICB0aGVyYXBldXRpY0R1cmF0aW9uOiBUaGVyYXBldXRpY0R1cmF0aW9uKEFkbWluaXN0cmF0aW9uLm1lZGljYXRpb24pLAogICAgICBzdGFydERhdGU6IHN0YXJ0IG9mIEFkbWluaXN0cmF0aW9uLmVmZmVjdGl2ZQogICAgcmV0dXJuCiAgICAgIGlmIHN0YXJ0RGF0ZSBpcyBub3QgbnVsbCBhbmQgdGhlcmFwZXV0aWNEdXJhdGlvbiBpcyBub3QgbnVsbCB0aGVuCiAgICAgICAgSW50ZXJ2YWxbc3RhcnREYXRlLCBzdGFydERhdGUgKyB0aGVyYXBldXRpY0R1cmF0aW9uXQogICAgICBlbHNlCiAgICAgICAgbnVsbAoKLypOb3cgdGhhdCB3ZSBoYXZlIGZ1bmN0aW9ucyBmb3IgZGV0ZXJtaW5pbmcgdGhlIG1lZGljYXRpb24gcGVyaW9kIGZvciBpbmRpdmlkdWFsCnByZXNjcmlwdGlvbnMsIGFkbWluaXN0cmF0aW9ucywgYW5kIGRpc3BlbnNlcywgd2UgY2FuIGNvbWJpbmUgdGhvc2UgdXNpbmcKYW4gb3ZlcmFsbCBjdW11bGF0aXZlIG1lZGljYXRpb24gZHVyYXRpb24gY2FsY3VsYXRpb24uCgpUaGVyZSBhcmUgdHdvIGJyb2FkIGFwcHJvYWNoZXMgdG8gY2FsY3VsYXRpbmcgY3VtdWxhdGl2ZSBkdXJhdGlvbiwgb25lIHRoYXQgX2NvbGxhcHNlc18Kb3ZlcmxhcHBpbmcgaW50ZXJ2YWxzIHNvIHRoYXQgY2FsY3VsYXRpb25zIGFyZSBub3QgZHVwbGljYXRlZCwgYW5kIG9uZSB0aGF0IF9yb2xscyBvdXRfCm92ZXJsYXBwaW5nIGludGVydmFscyBzbyB0aGF0IHRoZSBkdXJhdGlvbnMgYXJlIGxhaWQgZW5kLXRvLWVuZC4KCkZpcnN0LCB3ZSBkZWZpbmUgYSBmdW5jdGlvbiB0aGF0IHNpbXBseSBjYWxjdWxhdGVzIEN1bXVsYXRpdmVEdXJhdGlvbiBvZiBhIHNldCBvZgppbnRlcnZhbHM6Ki8KZGVmaW5lIGZ1bmN0aW9uICJDdW11bGF0aXZlRHVyYXRpb24iKEludGVydmFscyBMaXN0PEludGVydmFsPERhdGVUaW1lPj4gKToKICBTdW0oKGNvbGxhcHNlIEludGVydmFscyBwZXIgZGF5KSBYIHJldHVybiBhbGwgZGlmZmVyZW5jZSBpbiBkYXlzIGJldHdlZW4gc3RhcnQgb2YgWCBhbmQgZW5kIG9mIFgpCgovKk5leHQsIHdlIGRlZmluZSBhIGZ1bmN0aW9uIHRoYXQgcm9sbHMgb3V0IGludGVydmFsczoqLwpkZWZpbmUgZnVuY3Rpb24gIlJvbGxvdXRJbnRlcnZhbHMiKGludGVydmFscyBMaXN0PEludGVydmFsPERhdGVUaW1lPj4gKToKICBpbnRlcnZhbHMgSQogICAgYWdncmVnYXRlIFIgc3RhcnRpbmcgKG51bGwgYXMgTGlzdDxJbnRlcnZhbDxEYXRlVGltZT4+KToKICAgICAgUiB1bmlvbiAoewogICAgICAgIEkgWAogICAgICAgICAgbGV0CiAgICAgICAgICAgIFM6IE1heCh7IGVuZCBvZiBMYXN0KFIpICsgMSBkYXksIHN0YXJ0IG9mIFggfSksCiAgICAgICAgICAgIEU6IFMgKyBkdXJhdGlvbiBpbiBkYXlzIG9mIFgKICAgICAgICAgIHJldHVybiBJbnRlcnZhbFtTLCBFXQogICAgICB9KQoKLypUaGVuLCB3ZSBkZWZpbmUgYSBmdW5jdGlvbiB0aGF0IGFsbG93cyB1cyB0byBjYWxjdWxhdGUgYmFzZWQgb24gdGhlIHZhcmlvdXMgbWVkaWNhdGlvbgp0eXBlczoqLwpkZWZpbmUgZnVuY3Rpb24gIk1lZGljYXRpb25QZXJpb2QiKG1lZGljYXRpb24gQ2hvaWNlPCJNZWRpY2F0aW9uUmVxdWVzdCIsCiAgICAiTWVkaWNhdGlvbkRpc3BlbnNlIiwKICAgICJNZWRpY2F0aW9uQWRtaW5pc3RyYXRpb24iCiAgPiApOgogIGNhc2UKICAgIHdoZW4gbWVkaWNhdGlvbiBpcyBNZWRpY2F0aW9uUmVxdWVzdCB0aGVuIE1lZGljYXRpb25SZXF1ZXN0UGVyaW9kKG1lZGljYXRpb24pCiAgICB3aGVuIG1lZGljYXRpb24gaXMgTWVkaWNhdGlvbkRpc3BlbnNlIHRoZW4gTWVkaWNhdGlvbkRpc3BlbnNlUGVyaW9kKG1lZGljYXRpb24pCiAgICB3aGVuIG1lZGljYXRpb24gaXMgTWVkaWNhdGlvbkFkbWluaXN0cmF0aW9uIHRoZW4gTWVkaWNhdGlvbkFkbWluaXN0cmF0aW9uUGVyaW9kKG1lZGljYXRpb24pCiAgICBlbHNlIG51bGwKICBlbmQKCi8qV2UgY2FuIHRoZW4gdXNlIHRoaXMgZnVuY3Rpb24sIGNvbWJpbmVkIHdpdGggdGhlIE1lZGljYXRpb25EdXJhdGlvbiBmdW5jdGlvbnMgYWJvdmUKdG8gY2FsY3VsYXRlIEN1bXVsYXRpdmUgTWVkaWNhdGlvbiBEdXJhdGlvbjoKCkdlbmVyYWxseSBzcGVha2luZywgd2Ugd2FudCB0byBfcm9sbCBvdXRfIGludGVydmFscyBmcm9tIGRpc3BlbnNlIGFuZCBhZG1pbmlzdHJhdGlvbgpldmVudHMsIGFuZCB0aGVuIGNvbGxhcHNlIGFjcm9zcyB0aGF0IHJlc3VsdCBhbmQgaW50ZXJ2YWxzIGZyb20gcHJlc2NyaXB0aW9ucy4KCk5vdGUgYWxzbyB0aGF0IHRoZSBzZXBhcmF0aW9uIG9mIG1lZGljYXRpb25zIGJ5IHR5cGUgc2hvdWxkIGFscmVhZHkgYmUgZG9uZQpieSB0aGlzIHN0YWdlIGFzIHdlbGwuCgpDYWxjdWxhdGlvbnMgdGhhdCBjb21iaW5lIGRvc2FnZXMgZnJvbSBkaWZmZXJlbnQgdHlwZXMgb2YgbWVkaWNhdGlvbnMgKHN1Y2ggYXMgTW9ycGhpbmUgTWlsbGlncmFtIEVxdWl2YWxlbnQgKE1NRSkKb3IgQXZlcmFnZSBNTUUpIHJlcXVpcmUgZnVydGhlciBjb25zaWRlcmF0aW9uLiovCmRlZmluZSBmdW5jdGlvbiAiQ3VtdWxhdGl2ZU1lZGljYXRpb25EdXJhdGlvbiIoTWVkaWNhdGlvbnMgTGlzdDxDaG9pY2U8Ik1lZGljYXRpb25SZXF1ZXN0IiwKICAgICJNZWRpY2F0aW9uRGlzcGVuc2UiLAogICAgIk1lZGljYXRpb25BZG1pbmlzdHJhdGlvbiIKICA+PiApOgogIEN1bXVsYXRpdmVEdXJhdGlvbigoCiAgICAgIE1lZGljYXRpb25zIE0KICAgICAgICB3aGVyZSBNIGlzIE1lZGljYXRpb25SZXF1ZXN0CiAgICAgICAgcmV0dXJuIE1lZGljYXRpb25QZXJpb2QoTSkKICAgICkKICAgICAgdW5pb24gKAogICAgICAgIFJvbGxvdXRJbnRlcnZhbHMoCiAgICAgICAgICBNZWRpY2F0aW9ucyBNCiAgICAgICAgICAgIHdoZXJlIE0gaXMgTWVkaWNhdGlvbkRpc3BlbnNlIG9yIE0gaXMgTWVkaWNhdGlvbkFkbWluaXN0cmF0aW9uCiAgICAgICAgICAgIHJldHVybiBNZWRpY2F0aW9uUGVyaW9kKE0pCiAgICAgICAgKQogICAgICApCiAgKQoK"
  } ]
}